{% extends "../partials/layout.njk" %}

{%- from "moj/components/filter/macro.njk" import mojFilter -%}
{%- from "govuk/components/checkboxes/macro.njk" import govukCheckboxes -%}
{%- from "govuk/components/input/macro.njk" import govukInput -%}
{%- from "govuk/components/table/macro.njk" import govukTable -%}
{% from "moj/components/sub-navigation/macro.njk" import mojSubNavigation %}
{% from "govuk/components/select/macro.njk" import govukSelect %}
{% from "../components/selectWithOptGroup.njk" import govukSelectWithOptgroup %}
{%- from "govuk/components/button/macro.njk" import govukButton %}

{% set pageTitle = applicationName + " - Home" %}
{% set mainClasses = "app-container govuk-body" %}

{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <span class="govuk-caption-xl">Referrals in Brighton and Hove</span>
      <h1 class="govuk-heading-l">{{ presenter.text.pageHeading }}</h1>
    </div>
    {# TODO REMOVE THIS WHEN WE HAVE A PROPER ENTRY POINT INTO CREATE A GROUP #}
    {# Once the following ticket has been completed this will need to be removed #}
    {# https://dsdmoj.atlassian.net/browse/APG-1410 #}
    <div class="govuk-grid-column-one-third">
      {{ govukButton({text: "Create a group", href: "/group/create-a-group/create-group"}) }}
    </div>
  </div>
  <div class="govuk-grid-row">

    {%- set filterOptionsHtml %}
    <a class="clear-filters__link" href="?">Clear filters</a>
    {{ govukInput(searchByCrnOrPersonNameArgs) }}
    {{ govukSelect(searchByPduArgs) }}

    {% if not presenter.showReportingLocations %}
      <h2 class="govuk-heading-s govuk-!-margin-bottom-1">Reporting team</h2>
      <p class="govuk-body">Select a PDU and apply filters to see reporting teams</p>
    {% endif %}

    {% if presenter.showReportingLocations %}
      {{ govukCheckboxes(reportingTeamCheckboxArgs) }}
    {% endif %}

    {{ govukSelect(searchByCohortArgs) }}
    {{ govukSelectWithOptgroup(searchByStatusArgs) }}

    {% endset -%}
    <div class="govuk-grid-column-one-quarter">
      <form id="filter-form" method="get">
        {{ mojFilter({
          heading: {
            text: "Filter"
          },

        submit: {
          attributes: {
            "data-test-id": "submit-button"
          }
        },


        optionsHtml: filterOptionsHtml
        }) }}
      </form>
    </div>
    <div class="govuk-grid-column-three-quarters">
      {{ mojSubNavigation(subNavArgs) }}
      {% if presenter.referralCaseListItems.content.length > 0 %}
        {{ govukTable(presenter.getCaseloadTableArgs()) }}
      {% else %}
        <p class="govuk-body-l">{{ noResultsString }}</p>
      {% endif %}

      {% include "../partials/pagination.njk" %}
    </div>

  </div>

{% endblock %}